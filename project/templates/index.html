{% extends "base.html" %}

{% block title %} Map {% endblock %}

{% block head %}
<style>
   #map {
    height: 400px;
    width: 100%;
   }
</style>
{% endblock %}

{% block content %}
<div class="row d-flex justify-content-center">
  <div class="col-lg-8 col-md-8 col-sm-8" id="map" style="width: 800px; height: 700px;"></div>
</div>
<script>





  function initMap() {
    var houston = {lat: 29.7604267, lng: -95.3698028};
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 9,
      center: houston
    });

    {% for item in mapdata %}

      var markers = {
          coords: {
            lat: {{ item.latitude }},
            lng: {{ item.longitude }} },
          volunteers: {{ item.people_needed }},
          content: '<div id="iw-container">' +
                    '<div class="iw-title">Porcelain Factory of Vista Alegre</div>' +
                    '<div class="iw-content">' +


          '<h6>{{ item.description }}</h6><br><p><b>Name: </b> {{ item.first_name }}<br><b>Adress: </b> {{ item.address1 }}<br><b>Truck Needed: </b>{{ item.truck_needed }}<br><b>Volunteers Needed: </b>{{ item.people_needed }}</p>' +
          '<form class="form" action ="/volunteer_form" method ="post">' +                           
            '<div class="form-group">' +
              '<label for="first_name">Name:</label>' +
              '<input type="text" class="form-control" id="first_name" name="first_name" placeholder="First Name" required>' +
            '</div>' +
            '<div class="form-group">' +
              '<label for="last_name">Last Name:</label>' +
              '<input type="text" class="form-control" id="last_name" name="last_name" placeholder="Last Name" required>' +
            '</div>' +
            '<div class="form-group">' +
              '<label for="phone">Phone:</label>' +
              '<input type="text" class="form-control" id="phone" name="phone" placeholder="###-###-####" required>' +
            '</div>' +
            '<div class="form-group">' +
              '<label for="email">Email Address:</label>' +
              '<input type="email" class="form-control" id="email" name="email" placeholder="yourname@email.com" required>' +
            '</div>' +
            '<div class="form-group">' +
              '<label for="volunteers">Number of Volunteers:</label>' +
              '<select class="form-control" class="volunteers" id="volunteers" name="volunteers">' +
                '<option>1</option>' +
                '<option>2</option>' +
                '<option>3</option>' +
                '<option>4</option>' +
                '<option>5</option>' +
              '</select>' +
            '</div>' +
            '<div class="form-group">' +
              '<label for="has_truck">Do you have a large vehicle?:</label>' +
              '<select class="form-control" class="has_truck" id="has_truck" name="has_truck">' +
                '<option></option>' +
                '<option>Yes</option>' +
                '<option>No</option>' +
              '</select>' +
            '</div>' +
          '<input type="hidden" name="id" value="{{ item.id }}"/>' +
          '<button type="submit" class="btn btn-primary btn-lg btn-block">I want to volunteer</button>' +
          '</form>' +
          '</div>' +
          '</div>'
      };


      // Loop through markers
      addMarker(markers);

      //Set marker color
      function iconImage() {
        if (markers.volunteers == 0){
          return 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'
        }
        else {
          return 'http://maps.google.com/mapfiles/ms/icons/green-dot.png'
        }
      };

      // Add Marker Function
      function addMarker(props){
        var marker = new google.maps.Marker({
          position:props.coords,
          map:map,
          icon: iconImage(),
          animation: google.maps.Animation.DROP
        });

        // Check content

        var infoWindow = new google.maps.InfoWindow({
          content:props.content
        });

        marker.addListener('click', function(){
          infoWindow.open(map, marker);
        });

        google.maps.event.addListener(infowindow, 'domready', function() {

          // Reference to the DIV that wraps the bottom of infowindow
          var iwOuter = $('.gm-style-iw');

          /* Since this div is in a position prior to .gm-div style-iw.
           * We use jQuery and create a iwBackground variable,
           * and took advantage of the existing reference .gm-style-iw for the previous div with .prev().
          */
          var iwBackground = iwOuter.prev();

          // Removes background shadow DIV
          iwBackground.children(':nth-child(2)').css({'display' : 'none'});

          // Removes white background DIV
          iwBackground.children(':nth-child(4)').css({'display' : 'none'});

          // Moves the infowindow 115px to the right.
          iwOuter.parent().parent().css({left: '115px'});

          // Moves the shadow of the arrow 76px to the left margin.
          iwBackground.children(':nth-child(1)').attr('style', function(i,s){ return s + 'left: 76px !important;'});

          // Moves the arrow 76px to the left margin.
          iwBackground.children(':nth-child(3)').attr('style', function(i,s){ return s + 'left: 76px !important;'});

          // Changes the desired tail shadow color.
          iwBackground.children(':nth-child(3)').find('div').children().css({'box-shadow': 'rgba(72, 181, 233, 0.6) 0px 1px 6px', 'z-index' : '1'});

          // Reference to the div that groups the close button elements.
          var iwCloseBtn = iwOuter.next();

          // Apply the desired effect to the close button
          iwCloseBtn.css({opacity: '1', right: '38px', top: '3px', border: '7px solid #48b5e9', 'border-radius': '13px', 'box-shadow': '0 0 5px #3990B9'});

          // If the content of infowindow not exceed the set maximum height, then the gradient is removed.
          if($('.iw-content').height() < 140){
            $('.iw-bottom-gradient').css({display: 'none'});
          }

          // The API automatically applies 0.7 opacity to the button after the mouseout event. This function reverses this event to the desired value.
          iwCloseBtn.mouseout(function(){
            $(this).css({opacity: '1'});
          });
        });
      }


      google.maps.event.addDomListener(window, 'load', initialize);
    {% endfor %}
}


</script>
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC2iL6ewJ-ZbMXwS2nTEsGXHZbzOOCkFWo&callback=initMap">
</script>
{% endblock %}
